
**PrintNightmare** also known as CVE-2021-1675 and CVE-2021-34527.

Microsoft defines the [Print spooler service](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-prsod/7262f540-dd18-46a3-b645-8ea9b59753dc) as a service that runs on each computer system. As you can guess from the name, the Print spooler service manages the printing processes. The Print spooler's responsibilities are managing the print jobs, receiving files to be printed, queueing them, and scheduling.

> **FACTS TO REMEMBER**: A spooler is a computer utility that regulates data flow by receiving data (as from a word processor), queuing the data in a buffer, and then transmitting it (as to a printer) with increased efficiency.

You are able to Start/Stop/Pause/Resume the Print Spooler Service by simply navigating to Services on your Windows system.
![[Pasted image 20220616185339.png]]
**Print Spooler Properties(Services)**
![[Pasted image 20220616185400.png]]
Print spooler service makes sure to provide enough resources to the computers that send out the print jobs. In the early days when users had to wait for print jobs to finish to perform other operation. Well, the **print spooler service** to care of that issue for the users.

The Print spooler service allows the systems to act as print clients, administrative clients, or print servers. It is also important to note that the Print spooler service is enabled by default in all Windows clients and servers. It's necessary to have a Print spooler service on the computer to connect to a printer. There are third-party software and drivers provided by the printer manufacturers that would not require you to have the Print spooler service enabled. Still, most companies prefer to utilize Print spooler services.

Domain Controllers mainly use Print spooler service for [printer pruning](https://www.google.com/search?q=printer+pruning&client=opera-gx&hs=IGr&sxsrf=ALiCzsY_-4kZrMq5Vhmz_tHHXWSsrEqvTQ%3A1655377509965&ei=ZQ6rYpTBOoay2roPzIGnyA0&ved=0ahUKEwjUh83j6bH4AhUGmVYBHczACdkQ4dUDCA0&uact=5&oq=printer+pruning&gs_lcp=Cgdnd3Mtd2l6EAMyBQgAEIAEMgYIABAeEBYyBggAEB4QFjIGCAAQHhAWMgYIABAeEBYyBggAEB4QFjoHCAAQRxCwAzoHCAAQsAMQQzoKCAAQ5AIQsAMYAToPCC4Q1AIQyAMQsAMQQxgCOgQIABAeOgcIIxDqAhAnOgQIIxAnOgQILhAnOgQIABBDOgQILhBDOhAIABCABBCHAhCxAxCDARAUOgoIABCABBCHAhAUOgsIABCABBCxAxCDAToICAAQgAQQsQM6DQgAEIAEEIcCELEDEBQ6CAguEIAEELEDOggIABCABBDJAzoFCAAQkgM6BwgAELEDEEM6CggAELEDEIMBEAo6BwgAEIAEEAo6DggAEIAEELEDEIMBEMkDOg0IABCxAxCDARDJAxAKOgcIABCxAxAKOgQIABAKOggIABAeEBYQCkoECEEYAEoECEYYAVCZAVj1KmDPK2gHcAF4BYABpQKIAaMpkgEGMS44LjE2mAEAoAEBsAEKyAERwAEB2gEGCAEQARgJ2gEGCAIQARgI&sclient=gws-wiz) Printer pruning eliminates the issue for the users reaching out to a non-existent printer. You will know soon why we mentioned Domain Controller. 

---
To better understand the any vulnerability, you should get into the habit of researching the vulnerabilities by reading Microsoft articles on any Windows-specific CVE or browsing through the internet for community and vendor blogposts.

There has been some confusion if the [CVE-2021-1675](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-1675) and [CVE-2021-34527](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527) are related to each other. They go under the same name: **Windows Print Spooler Remote Code Execution Vulnerability** and are both related to the **Print Spooler**.

As [Microsoft](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527) states in the FAQ, the PrintNightmare (CVE-2021-34527) vulnerability _"is similar but distinct from the vulnerability that is assigned CVE-2021-1675._ _The attack vector is different as well."_

<u>What did Microsoft mean by the attack vector?</u>

According to  [Microsoft](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527), PrintNightmare vulnerability is _"a remote code execution vulnerability exists when the Windows Print Spooler service improperly performs privileged file operations. An attacker who successfully exploited this vulnerability could **run arbitrary code** with SYSTEM privileges. An attacker could then install programs; view, change, or delete data; or create new accounts with full user rights."

Running arbitrary code involves executing any commands of the attacker's choice and preference on a victim's machine. To exploit the **CVE-2021-1675** vulnerability, the attacker would need to have direct or local access to the machine to use a malicious DLL file to escalate privileges. To exploit the **CVE-2021-34527** vulnerability successfully, the attacker can remotely inject the malicious DLL file.

Vulnerability metrics for **CVE-2021-1675**
![[Pasted image 20220616201852.png]]

Vulnerability metrics for **CVE-2021-34527**
![[Pasted image 20220616201926.png]]

**Timeline:**  
- June 8, 2021: Microsoft issued a patch for a privilege escalation vulnerability in the print spooler service (CVE-2021-1675).
- June 21, 2021: Microsoft revised the vulnerability and changed its classification to remote code execution (RCE).
- June 27, 2021: Chinese cybersecurity firm QiAnXin [published a video](https://twitter.com/RedDrip7/status/1409353110187757575) demonstrating local privilege escalation (LPE) and RCE.
- July 2, 2021: Microsoft assigns a new CVE so-called **PrintNightmare** vulnerability in the print spooler service (CVE-2021-34527).
- July 6, 2021: Microsoft released an out-of-band patch (a patch released at some time other than the normal release time) to address CVE-2021-34527 and provides additional workarounds to defend against the exploit.

## What makes PrintNightmare dangerous?
1. It can be exploited over the network; the attacker doesn't need direct access to the machine.
2. The [proof-of-concept](https://github.com/cube0x0/CVE-2021-1675) was made public on the Internet.
3. the Print Spooler service is enabled by DEFAULT on domain controllers and computers with SYSTEM privileges.