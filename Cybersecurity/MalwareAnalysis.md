# Introduction to Malware Analysis
As a SOC Analyst, you will often analyze suspicious files in your daily work routine. With the Malware fundamentals training, the necessary basic information will be learned by introducing the subject of malware analysis.

## How Malware Analysis Help SOC Analysts
Have you ever heard of Stuxnet before? The US and Israeli intelligence services created Stuxnet to disrupt Iran's nuclear work. This malware, which was first detected in 2010, still has a complex structure even today. Although it contains many zero-day vulnerabilities, it provides propagation with USB devices. This malware damaged Iranâ€™s Natanz uranium enrichment plants and caused it to be closed permanently.
![[Pasted image 20220520072011.png]]

As you can see in the Stuxnet example, even if you are not very close to technology in your life, the impact of malware on our lives is quite high.

What about the importance of malwares in SOC for a person who wants to be a security analyst?

When you examine the work routine of a standard Security Analyst, you will see that the analysts frequently encounter suspicious files or processes. Considering that malware is used in the vast majority of cyber attacks, you can understand that this information is not unusual.

As a Security Analyst, you should be able to analyze and figure out whether these files are harmful; and, if it is malicious, you should understand the purpose of this software and how it communicates with the command and control servers. It is an undeniable fact that malware analysis is an indispensable know-how for Security Analysts.

Many malware analysis methods and techniques are available to examine suspicious files. In this training series, you can analyze malware using the most appropriate technique for your needs.

A malware may contain more than one feature, so a malware can belong to more than one type. For example, WannaCry malware includes both worm and ransomware malware features.

## What should a Malware Analyst Know
Malware analysis is a subject that may seem easy from the outside, but in essence, it requires expertise in many aspects. While malware analysis is a separate field in its own right, some Tier 3 SOC Analysts (Subject Matter Experts) focus their careers in malware analysis only. Although malware analysis is a separate field, it is often used by Security Analysts in their daily work routines. 

In order to be able to analyze maliciuos software correctly and successfully, it is necessary to have the basics in many subjects. Let's take a look at these topics.

### OS Fundamentals and Architecture
Since malware runs on operating systems, malware analysts should have a solid understanding and knowledge of the operating systems.
![[Pasted image 20220520075703.png]]

Malware often takes advantage of the features offered by the operating system, increasing its privileges, making discovery and ensuring persistence. To give an example on Windows operating systems, malicious software uses the features of the operating system such as Task Scheduler, Services, Registry to ensure persistence.

In addition to the features of the operating system, API, Syscalls, Memory Architecture and lower level issues are also important for successful malware analysis. We will focus on these topics more on the "Static Malware Analysis" training.

### Assembly Language & Programming
If you ever developed software before, have you wondered what happens when you compile the programming languages you write? Or have you ever wondered how the processors run multiple programming languages when there are many programming languages.

Processors only understand 0s and 1s. All data, except 0 and 1 are meaningless to the processors. When you compile any program in languages such as, C/C++, Python, Java, Ruby, Go etc. compilers translate the codes you write into 0s and 1s that the processor can understand. When you start a program, these 0s and 1s are sent to the processor over the memory to run.

![[Pasted image 20220520080126.png]]

The lowest level programming language you can see is Assembly if we do not consider 0s and 1s. Each instruction has a direct 0 and 1 counterpart. When you compile a program written in C, it is first translated to Assembly language and then to 0s and 1s.

Compiled malware can be easily converted into the Assembly language. However, converting from Assembly language to the next level is not very easy and accurate, so analysis are usually made through Assembly language. Software that translates machine codes into Assembly language is called "**Disassembler**".

In the static code analysis training, we will also focus on the basics of the "Assembly" Language.

### Network Protocols and Fundamentals
Malware often exhibits network activity in order to hijack information, connect to a command and control server, or download second payloads. Understanding these network traffics while analyzing malware is extremely important for us to understand the purpose of the malware.

### Cryptography
Many technologies make use of cryptography to provide security. It is also used by attackers for purposes such as complicating, preventing detection and preventing access.

Popular ransomware uses cryptography nowadays to encrypt files and prevent access to files without paying a ransom.

We often encounter cryptography during malware analysis.

## Which Approach Should You Choose When Analyzing Malware?
If you work in the defensive field, analyzing malware becomes part of your job.

In this article, we will discuss with which approaches you can analyze malware and the advantages / disadvantages of these approaches to each other.

There are 2 different approaches to analyzing malware.
1. Static Analysis
2. Dynamic Analysis

### What is Static Analysis?
It is the approach of analyzing malicious software by reverse engineering methods without running them. Generally, by decompile/disassemble the malware, each step that the malware will execute is analyzed, hence the behavior/capacity of the mware can be analyzed.
![[Pasted image 20220520081649.png]]

Your device will not be infected as you do not run malicious software in static analysis. (However, we do not recommend performing static analysis on your host device, it will be more proper to do your analysis in a virtual operating system.)

The information examined during the static analysis is as follows.
1. P.E. (Portable Executable) Headers
2. Imported DLL's
3. Exported DLL's
4. Strings in binary
5. CPU Instructions

### What is Dynamic Analysis
It is the approach that examines the behavior of malicious software on the system by running it. 

In dynamic analysis, applications that can examine registry, file, network and process events are installed in the system, and their behavior is examined by running malicous software.

While doing dynamic analysis, you should carefully examine the following events.
1. Networks Connections
2. File Events
3. Process Events
4. Registry Events

### Static vs Dynamic Analysis
Which approach to use when analyzing malware depends on the current circumstances. In cases where you want to get fast results, you can choose dynamic analysis, but we cannot say that the analysis is complete without doing both static and dynamic analysis.

It should also be noted that using only one approach may not be sufficient to analyze malware. Using both approaches together will lead you to victory!
![[Pasted image 20220520082439.png]]
As a result, we cannot say that one approach is better than another. Each has an advantage over each other in different conditions.

If you work as a Level 1-2 SOC analyst, you can usually take action by quickly obtaining the address c2 with the help of dynamic analysis.

## Dynamic Analysis Example Using AnyRun
You can take advantage of sandbox services / products to quickly analyze malware.

[AnyRun](https://any.run/) is an interactive sandbox that you can use when you want to analyze malware quickly.

AnyRun has options for paid or free use. If you want to take advantage of it for free, all your analysis is visible to others, therefore we do not recommend that you upload files that may contain personal data to AnyRun. In addition, the free plan has restrictions such as usage time.

How can we use AnyRun for our malware analysis, what kind of outputs we can get, let's examine it together.

Let's download the malware with hash **80b51e872031a2befeb9a0a13e6fc480** to analyze via [AbuseCH (Click here to download)](https://bazaar.abuse.ch/sample/708e198608b5b463224c3fb77fcf708b845d0c7b5dbc6e9cab9e185c489be089/).

We have to click on the "**+**" **(New Task)** button on the left menu to upload the malware we downloaded.
